# 进程线程和协程

## 进程

进程是具有一定独立功能的程序关于某个数据集合上的一次运行活动,进程是系统进行资源分配和调度的一个独立单位。每个进程都有自己的独立内存空间，不同进程通过进程间通信来通信。由于进程比较重量，占据独立的内存，所以上下文进程间的切换开销（栈、寄存器、虚拟内存、文件句柄等）比较大，但相对比较稳定安全。

## 线程

线程是进程的一个实体，是CPU调度和分派的基本单位,它是比进程更小的能独立运行的基本单位。线程自己基本上不拥有系统资源，只拥有一点在运行中必不可少的资源(如程序计数器,一组寄存器和栈),但是它可与同属一个进程的其他的线程共享进程所拥有的全部资源。线程间通信主要通过共享内存，上下文切换很快，资源开销较少，但相比进程不够稳定容易丢失数据。

## 协程

**协程是一种用户态的轻量级线程，**协程的调度完全由用户控制。协程拥有自己的寄存器上下文和栈。协程调度切换时，将寄存器上下文和栈保存到其他地方，在切回来的时候，恢复先前保存的寄存器上下文和栈，直接操作栈则基本没有内核切换的开销，可以不加锁的访问全局变量，所以上下文的切换非常快。

在Java中可以通过Coroutine来创建协程。

## 区别

### 进程与线程比较

线程是指进程内的一个执行单元，也是进程内的可调度实体。线程与进程的区别：

+ 地址空间:线程是进程内的一个执行单元，进程内至少有一个线程，它们共享进程的地址空间，而进程有自己独立的地址空间
+ 资源拥有:进程是资源分配和拥有的单位,同一个进程内的线程共享进程的资源
+ 线程是处理器调度的基本单位,但进程不是
+ 二者均可并发执行
+ 每个独立的线程有一个程序运行的入口、顺序执行序列和程序的出口，但是线程不能够独立执行，必须依存在应用程序中，由应用程序提供多个线程执行控制

### 协程与线程进行比较

1) 一个线程可以多个协程，一个进程也可以单独拥有多个协程，这样python中则能使用多核CPU。

2) 线程进程都是同步机制，而协程则是异步

3) 协程能保留上一次调用时的状态，每次过程重入时，就相当于进入上一次调用的状态

## 线程的分类

### 用户线程

是用户创建的一般线程，如继承Thread类或实现Runnable接口等实现的线程。

### 守护线程

是为用户线程提供服务的线程，如JVM的垃圾回收、内存管理等线程。

### 区别

守护线程和用户线程的区别：当一个用户线程结束后，JVM会检查系统中是否还存在其他用户线程，如果存在则按照正常的调用方法调用。但是如果只剩守护线程而没有用户线程的话，JVM就会终止（从始至终都没有理睬守护线程）。
任何线程都可以是守护线程或者用户线程，所有线程一开始都是用户线程。
涉及守护线程的方法有两个：setDaemon( )和 isDaemon()。
Thread.setDaemon(false/true)设置为用户线程/守护线程；如果不设置该属性，默认为false。

需要注意的是：setDaemon()方法仅仅在线程对象已经被创建但是还没有运行前才能被调用，否则会报错。





